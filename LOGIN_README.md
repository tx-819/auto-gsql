# 登录功能实现

## 功能概述

应用现在包含完整的登录认证系统，用户需要先登录才能访问主功能。

## 新增功能

### 1. 登录页面 (`/login`)

- 美观的登录界面，支持用户名和密码登录
- 密码显示/隐藏切换
- 登录状态加载指示器
- 错误信息显示
- 响应式设计
- 支持注册成功消息显示

### 2. 注册页面 (`/register`)

- 完整的用户注册界面
- 用户名、邮箱、密码和确认密码输入
- 实时表单验证
- 密码强度检查
- 邮箱格式验证
- 注册成功后自动跳转到登录页面

### 3. 认证路由保护

- 自动检查用户登录状态
- 未登录用户自动跳转到登录页面
- 登录成功后自动跳转到主页面

### 4. 用户会话管理

- 使用keytar安全存储用户会话
- 支持自动登录（记住登录状态）
- 安全的登出功能
- 动态用户管理（支持新用户注册）

## 测试账户

系统包含以下测试账户：

| 用户名 | 密码     | 说明         |
| ------ | -------- | ------------ |
| admin  | admin123 | 管理员账户   |
| user   | user123  | 普通用户账户 |

## 技术实现

### 1. 认证流程

```
用户访问应用 → AuthGuard检查登录状态 → 未登录跳转登录页 → 登录成功跳转主页
```

### 2. 数据存储

- **用户会话**: 存储在keytar中，键名 `auto-gsql/current-user`
- **安全性**: 比localStorage更安全，利用系统密钥管理

### 3. 文件结构

```
src/
├── main/
│   └── index.ts                       # 添加了认证和注册IPC处理器
├── preload/
│   ├── index.ts                       # 暴露认证和注册API
│   └── index.d.ts                     # 更新类型定义
└── renderer/
    ├── src/
    │   ├── pages/
    │   │   ├── login/
    │   │   │   └── index.tsx          # 登录页面
    │   │   └── register/
    │   │       └── index.tsx          # 注册页面
    │   ├── components/
    │   │   └── AuthGuard.tsx          # 认证路由保护
    │   ├── utils/
    │   │   └── auth.ts                # 认证工具函数
    │   └── main.tsx                   # 更新路由配置
```

## 使用方法

### 1. 首次访问

1. 打开应用
2. 自动跳转到登录页面
3. 输入测试账户信息
4. 点击登录按钮
5. 登录成功后自动跳转到主页面

### 2. 新用户注册

1. 在登录页面点击"立即注册"
2. 填写用户名（至少3个字符）
3. 输入有效的邮箱地址
4. 设置密码（至少6个字符）
5. 确认密码
6. 点击注册按钮
7. 注册成功后自动跳转到登录页面

### 3. 已登录用户

- 直接访问主页面，无需重新登录
- 会话信息保存在系统密钥管理器中

### 4. 登出功能

- 在设置页面可以添加登出按钮
- 或者清除keytar中的用户会话数据

## API接口

### 主进程IPC处理器

- `get-current-user`: 获取当前用户信息
- `save-user-session`: 保存用户会话
- `clear-user-session`: 清除用户会话
- `login`: 验证登录凭据
- `register`: 用户注册

### 渲染进程API

- `window.api.getCurrentUser()`: 获取当前用户
- `window.api.saveUserSession()`: 保存会话
- `window.api.clearUserSession()`: 清除会话
- `window.api.login()`: 登录验证
- `window.api.register()`: 用户注册

## 安全特性

1. **密钥存储**: 使用keytar安全存储用户会话
2. **路由保护**: 未认证用户无法访问受保护页面
3. **会话管理**: 自动管理用户登录状态
4. **错误处理**: 完善的错误处理和用户提示

## 扩展功能

### 1. 密码重置

- 添加忘记密码功能
- 支持邮箱验证重置

### 2. 多因素认证

- 支持2FA认证
- 提高账户安全性

### 3. 用户管理

- 用户资料管理
- 权限控制
- 用户设置

### 4. 邮箱验证

- 注册后邮箱验证
- 提高账户安全性

## 故障排除

### 1. 登录失败

- 检查用户名和密码是否正确
- 确认网络连接正常
- 查看控制台错误信息

### 2. 会话丢失

- 检查keytar是否正确安装
- 确认系统密钥管理器权限
- 重新登录即可

### 3. 路由问题

- 确保AuthGuard组件正确配置
- 检查路由路径设置
- 验证组件导入正确
